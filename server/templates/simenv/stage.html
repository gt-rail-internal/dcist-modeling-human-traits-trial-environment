<!DOCTYPE html>

<head>
    <link rel="shortcut icon" type="image/png" href="{{url_for('static', filename='simenv/img/favicon.ico')}}" />

    <link rel="stylesheet" href="{{url_for('static', filename='simenv/css/style.css')}}">

    <!-- Roboto font import -->
    <style>@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap');</style> 

    <!-- JS imports for the local JavaScript files -->
    <script src="{{url_for('static', filename='simenv/js/drawing.js')}}"></script>
    <script src="{{url_for('static', filename='simenv/js/engine.js')}}"></script>
    <script src="{{url_for('static', filename='simenv/js/inputUtils.js')}}"></script>
    <script src="{{url_for('static', filename='simenv/js/stage1.js')}}"></script>
    <script src="{{url_for('static', filename='simenv/js/stage2.js')}}"></script>
    <script src="{{url_for('static', filename='simenv/js/testStage.js')}}"></script>
    <script src="{{url_for('static', filename='simenv/js/uiMap.js')}}"></script>
    <script src="{{url_for('static', filename='simenv/js/uiObjects.js')}}"></script>

    <title>Experiment Task</title>
</head>

<body>    
    <div class="titlebar" style="display: flex; justify-content: center;">
        <div class="title" id="titlebar">
            Experiment Task
        </div>
    </div>

    <div style="display: flex; justify-content: space-between;">
        <div class="side-panel" id="left-panel">
            <div class="cam-container">
                <div id="cam1" class="cam red"><img id="cam1_image" height="100%" width="100%"/></div>
                <div id="cam1_button" class="cam-button red">Mark Cache</div>
            </div>
            <div class="cam-container">
                <div id="cam3" class="cam blue"><img id="cam3_image" height="100%" width="100%"/></div>
                <div id="cam3_button" class="cam-button blue">Mark Cache</div>
            </div>
        </div>

        <div class="center-panel" id="map-panel">
            <div style="display: flex; flex-direction: row;">
                <div class="instructions grey-instructions giveup" id="instructions-top"></div>
                <div class="instructions grey-instructions giveup" id="instructions-giveup" style="margin-left: 1%;">If you wish to give up, click here.</div>
            </div>
            <canvas class="uimap" id="uimap-canvas"></canvas>
            <div class="instructions" id="instructions-bottom">Click a robot to select it, and click on the map to add waypoints for the robot to travel to. Press <b>r</b> to remove the last waypoint, and press <b>q</b> to deselect the robot.</div>
        </div>


        <div class="side-panel" id="right-panel">
            <div class="cam-container">
                <div id="cam2" class="cam purple"><img id="cam2_image" height="100%" width="100%"/></div>
                <div id="cam2_button" class="cam-button purple">Mark Cache</div>
            </div>
            <div class="cam-container">
                <div id="cam4" class="cam gold"><img id="cam4_image" height="100%" width="100%"/></div>
                <div id="cam4_button" class="cam-button gold">Mark Cache</div>
            </div>
        </div>

        
    </div>

<script>


    startTime = new Date().getTime() / 1000

    // create the UI Map object
    uiMap = Object;

    // initialize the UI Map
    uiMap = new UIMap("uimap-canvas")
    document.getElementById("uimap-canvas").height = "700";
    document.getElementById("uimap-canvas").width = "700";

    // record the worker ID
    uiMap.workerID = "{{ worker_id }}";

    

    // have the map update almost constantly
    window.setInterval(function() {
        uiMap.draw();
    }, 100);

    if ("{{ stage }}" == "0") {
        console.log("Launching Test Stage")
        initTestStage();
    }
    
    // initialize Stage 1
    //initStage1();

    // initialize Stage 2
    if ("{{ stage }}" == "2") {
        console.log("Launching Stage 2");
        initStage2();
    }

    // initialize the engine
    initEngine();
    
</script>

</body>

</html>
