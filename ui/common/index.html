<html>

<head>
    <link rel="shortcut icon" type="image/png" href="/favicon.ico" />

    <link rel="stylesheet" href="style.css">

    <!-- Roboto font import -->
    <style>@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap');</style> 

    <!-- JS imports for the ROS JavaScript Library-->
    <script type="text/javascript" src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    <script src="https://static.robotwebtools.org/roslibjs/current/roslib.js"></script>

    <!-- JS imports for the local JavaScript files -->
    <script src="js/drawing.js"></script>
    <script src="js/inputUtils.js"></script>
    <script src="js/uiMap.js"></script>
    <script src="js/uiObjects.js"></script>

</head>

<body>    
    <div class="titlebar" style="display: flex; justify-content: center;">
        <div class="title">
            Human-Robot Teaming - Simulation Environment
        </div>
    </div>
    <br>

    <div style="display: flex; justify-content: center;">
        <div class="side-panel">
            <div class="cam-container">
                <div id="cam1" class="cam red"></div>
                <div id="cam1_button" class="cam-button red">Mark Cache</div>
            </div>
            <div class="cam-container">
                <div id="cam3" class="cam blue"></div>
                <div id="cam3_button" class="cam-button blue">Mark Cache</div>
            </div>
        </div>

        <div>
            <div class="instructions">
                Stage 1: Search for the packages
            </div>
            <canvas class="uimap" id="uimap-canvas"></canvas>
        </div>


        <div class="side-panel" style="display: flex">
            <div class="cam-container">
                <div id="cam2" class="cam purple"></div>
                <div id="cam2_button" class="cam-button purple">Mark Cache</div>
            </div>
            <div class="cam-container">
                <div id="cam4" class="cam gold"></div>
                <div id="cam4_button" class="cam-button gold">Mark Cache</div>
            </div>
        </div>
    </div>
</body>

<script>

    // NOTE!! You should install rosbridge (https://wiki.ros.org/rosbridge_suite) and run:
    //     roslaunch rosbridge_server rosbridge_websocket.launch
    // to start the websocket server so the webpage can communicate with ROS

    // initialize ROS
    // adapted from the roslibjs docs

    // create the UI Map object
    uiMap = Object;

    // set up the connection to the rosbridge server
    var ros = new ROSLIB.Ros({
        url: 'ws://localhost:9090',
    })

    ros.on('connection', () => {
        console.log("Connected to the websocket server.");
        initUIMap();
    })

    ros.on('error', (error) => {
        console.log('Error connecting to websocket server: ', error);
    })

    ros.on('close', function() {
        console.log('Connection to websocket server closed.');
    })

    // initialized the UI Map and UAV UI Map Objects
    function initUIMap() { 
        uiMap = new UIMap("uimap-canvas")

        // start the UI Map
        document.getElementById("uimap-canvas").height = "700";
        document.getElementById("uimap-canvas").width = "700";
        
        // initialize two UAVs and UGVs
        uav1 = new Vehicle("uav");
        uav1.initPositionListener("uav1");
        uav1.x = 10;
        uav1.y = 30;

        uav2 = new Vehicle("uav");
        uav2.initPositionListener("uav2");
        uav2.x = 150;
        uav2.y = 90;

        ugv1 = new Vehicle("ugv");
        ugv1.initPositionListener("ugv1");
        ugv1.x = 20;
        ugv1.y = 160;

        ugv2 = new Vehicle("ugv");
        ugv2.initPositionListener("ugv2");
        ugv2.x = 80;
        ugv2.y = 40;

        // add them to the UI Map
        uiMap.uiObjects.push(uav1);
        uiMap.uiObjects.push(uav2);
        uiMap.uiObjects.push(ugv1);
        uiMap.uiObjects.push(ugv2);

        // have the map update almost constantly
        window.setInterval(function() {
            uiMap.draw();
        }, 100);

        // have the map update camera images almost constantly
        window.setInterval(function() {
            fetch("https://143.215.60.229:5000/cam?id=1")
            .then(response => response.json())
            .then(data => console.log(data));
        }, 10000)

        // add a mount event handler for the canvas
        window.addEventListener("mousedown", canvasMouseHandler);

        // add a keypress listener
        window.addEventListener("keypress", canvasKeypressHandler);
    }
    
</script>

</html>